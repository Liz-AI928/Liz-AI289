<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Liz AI HUD Voice Control</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin:0; overflow:hidden; background:#000; color:white; }
    #mainWaveCanvas { width:100%; height:60vh; display:block; opacity:0; transition:opacity 0.6s ease; }
    #chatInput { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); width:300px; background:#111; border:1px solid #38bdf8; color:#38bdf8; padding:8px; border-radius:6px; font-family:monospace; }
  </style>
</head>
<body>
  <div class="absolute top-4 left-4 text-sm text-sky-400" id="statusLeft">SLEEP</div>
  <canvas id="mainWaveCanvas"></canvas>
  <input id="chatInput" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡πÄ‡∏ä‡πà‡∏ô: ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏•‡πà‡∏≤‡∏°">

  <script>
    let isListening = false;
    let isProcessing = false;
    let waveState = "sleep"; // sleep | listening | thinking

    // --- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ---
    function playBeep(type="default"){
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();

      osc.connect(gain);
      gain.connect(ctx.destination);

      if(type==="listening"){ osc.frequency.value = 880; }      // ‡πÇ‡∏ó‡∏ô‡∏™‡∏π‡∏á
      else if(type==="thinking"){ osc.frequency.value = 440; }  // ‡πÇ‡∏ó‡∏ô‡∏Å‡∏•‡∏≤‡∏á
      else { osc.frequency.value = 220; }                       // ‡πÇ‡∏ó‡∏ô‡∏ï‡πà‡∏≥

      osc.type = "sine";
      gain.gain.setValueAtTime(0.2, ctx.currentTime);
      osc.start();
      osc.stop(ctx.currentTime + 0.25); // ‡πÄ‡∏•‡πà‡∏ô 0.25s
    }

    // --- Waveform ---
    function setWaveState(state) {
      waveState = state;
      document.getElementById("statusLeft").textContent = state.toUpperCase();

      // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      if(state==="listening") playBeep("listening");
      else if(state==="thinking") playBeep("thinking");
      else playBeep("sleep");
    }

    function initWaveGlow() {
      const canvas = document.getElementById("mainWaveCanvas");
      const ctx = canvas.getContext("2d");

      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight * 0.6;
      }
      window.addEventListener("resize", resize);
      resize();

      let phase = 0;

      function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        const midY = canvas.height/2;

        if (waveState==="sleep") {
          ctx.beginPath();
          ctx.lineWidth=1.5;
          ctx.strokeStyle="#6366f1";
          ctx.shadowBlur=15; ctx.shadowColor="#6366f1";
          const amp=10, freq=0.01;
          for(let x=0;x<canvas.width;x++){
            const y=midY+Math.sin(x*freq+phase)*amp;
            x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
          }
          ctx.stroke();
        }
        else if (waveState==="listening") {
          ctx.beginPath();
          ctx.lineWidth=3;
          ctx.strokeStyle="#06b6d4";
          ctx.shadowBlur=25; ctx.shadowColor="#06b6d4";
          const amp=40, freq=0.025;
          for(let x=0;x<canvas.width;x++){
            const y=midY+Math.sin(x*freq+phase)*amp;
            x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
          }
          ctx.stroke();
        }
        else if (waveState==="thinking") {
          const colors=["#f59e0b","#ec4899","#3b82f6"];
          colors.forEach((c,i)=>{
            ctx.beginPath();
            ctx.lineWidth=2;
            ctx.strokeStyle=c;
            ctx.shadowBlur=20; ctx.shadowColor=c;
            const amp=20+i*15, freq=0.015+i*0.005;
            for(let x=0;x<canvas.width;x++){
              const y=midY+Math.sin(x*freq+phase+i)*amp;
              x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
            }
            ctx.stroke();
          });
        }
        phase+= waveState==="sleep"?0.01 : waveState==="listening"?0.08 : 0.05;
        requestAnimationFrame(draw);
      }
      draw();
      canvas.style.opacity=1;
    }

    function updateWaveState(){
      if (isProcessing) setWaveState("thinking");
      else if (isListening) setWaveState("listening");
      else setWaveState("sleep");
    }
    function startListening(){ isListening=true; isProcessing=false; updateWaveState();}
    function stopListening(){ isListening=false; updateWaveState();}
    function startProcessing(){ isProcessing=true; updateWaveState();}
    function stopProcessing(){ isProcessing=false; updateWaveState();}

    // --- Voice Commands ---
    function initVoiceControl(){
      if(!('webkitSpeechRecognition' in window)){
        console.warn("SpeechRecognition ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô browser ‡∏ô‡∏µ‡πâ");
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = "th-TH";
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onresult = (event)=>{
        const transcript = event.results[event.results.length-1][0].transcript.trim();
        console.log("üéôÔ∏è ‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô:", transcript);
        handleCommand(transcript);
      };

      recognition.onerror = (e)=> console.error("Voice error:",e);
      recognition.start();
    }

    // --- Command Handler ---
    function handleCommand(cmd){
      cmd = cmd.toLowerCase();
      if(cmd.includes("‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏•‡πà‡∏≤‡∏°") || cmd.includes("start listening")) startListening();
      else if(cmd.includes("‡∏´‡∏¢‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏°") || cmd.includes("stop listening")) stopListening();
      else if(cmd.includes("‡∏Ñ‡∏¥‡∏î") || cmd.includes("thinking")) startProcessing();
      else if(cmd.includes("‡∏û‡∏±‡∏Å") || cmd.includes("sleep")) { stopListening(); stopProcessing(); }
    }

    // --- Input Command (Text) ---
    document.getElementById("chatInput").addEventListener("keypress",e=>{
      if(e.key==="Enter"){
        handleCommand(e.target.value);
        e.target.value="";
      }
    });

    // --- Init ---
    initWaveGlow();
    updateWaveState();
    initVoiceControl();
  </script>
</body>
</html>
